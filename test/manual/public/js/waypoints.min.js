(function(e,t,i,n){var r=e(n),o="waypoint.reached",s=function(e,i){e.element.trigger(o,i),e.options.triggerOnce&&e.element[t]("destroy")},a=function(e,t){if(!t)return-1;for(var i=t.waypoints.length-1;i>=0&&t.waypoints[i].element[0]!==e[0];)i-=1;return i},u=[],c=function(t){e.extend(this,{element:e(t),oldScroll:0,waypoints:[],didScroll:!1,didResize:!1,doScroll:e.proxy(function(){var t=this.element.scrollTop(),n=t>this.oldScroll,r=this,o=e.grep(this.waypoints,function(e){return n?e.offset>r.oldScroll&&t>=e.offset:e.offset<=r.oldScroll&&e.offset>t}),a=o.length;this.oldScroll&&t||e[i]("refresh"),this.oldScroll=t,a&&(n||o.reverse(),e.each(o,function(e,t){(t.options.continuous||e===a-1)&&s(t,[n?"down":"up"])}))},this)}),e(t).bind("scroll.waypoints",e.proxy(function(){this.didScroll||(this.didScroll=!0,n.setTimeout(e.proxy(function(){this.doScroll(),this.didScroll=!1},this),e[i].settings.scrollThrottle))},this)).bind("resize.waypoints",e.proxy(function(){this.didResize||(this.didResize=!0,n.setTimeout(e.proxy(function(){e[i]("refresh"),this.didResize=!1},this),e[i].settings.resizeThrottle))},this)),r.load(e.proxy(function(){this.doScroll()},this))},l=function(t){var i=null;return e.each(u,function(e,n){return n.element[0]===t?(i=n,!1):void 0}),i},f={init:function(n,r){return this.each(function(){var s,f=e.fn[t].defaults.context,d=e(this);r&&r.context&&(f=r.context),e.isWindow(f)||(f=d.closest(f)[0]),s=l(f),s||(s=new c(f),u.push(s));var p=a(d,s),h=0>p?e.fn[t].defaults:s.waypoints[p].options,m=e.extend({},h,r);m.offset="bottom-in-view"===m.offset?function(){var t=e.isWindow(f)?e[i]("viewportHeight"):e(f).height();return t-e(this).outerHeight()}:m.offset,0>p?s.waypoints.push({element:d,offset:null,options:m}):s.waypoints[p].options=m,n&&d.bind(o,n),r&&r.handler&&d.bind(o,r.handler)}),e[i]("refresh"),this},remove:function(){return this.each(function(t,i){var n=e(i);e.each(u,function(e,t){var i=a(n,t);i>=0&&(t.waypoints.splice(i,1),t.waypoints.length||(t.element.unbind("scroll.waypoints resize.waypoints"),u.splice(e,1)))})})},destroy:function(){return this.unbind(o)[t]("remove")}},d={refresh:function(){e.each(u,function(t,n){var r=e.isWindow(n.element[0]),o=r?0:n.element.offset().top,a=r?e[i]("viewportHeight"):n.element.height(),u=r?0:n.element.scrollTop();e.each(n.waypoints,function(e,t){if(t){var i=t.options.offset,r=t.offset;if("function"==typeof t.options.offset)i=t.options.offset.apply(t.element);else if("string"==typeof t.options.offset){var c=parseFloat(t.options.offset);i=t.options.offset.indexOf("%")?Math.ceil(a*(c/100)):c}t.offset=t.element.offset().top-o+u-i,t.options.onlyOnScroll||(null!==r&&n.oldScroll>r&&n.oldScroll<=t.offset?s(t,["up"]):null!==r&&r>n.oldScroll&&n.oldScroll>=t.offset?s(t,["down"]):!r&&n.element.scrollTop()>t.offset&&s(t,["down"]))}}),n.waypoints.sort(function(e,t){return e.offset-t.offset})})},viewportHeight:function(){return n.innerHeight?n.innerHeight:r.height()},aggregate:function(){var t=e();return e.each(u,function(i,n){e.each(n.waypoints,function(e,i){t=t.add(i.element)})}),t}};e.fn[t]=function(i){return f[i]?f[i].apply(this,Array.prototype.slice.call(arguments,1)):"function"!=typeof i&&i?"object"==typeof i?f.init.apply(this,[null,i]):(e.error("Method "+i+" does not exist on jQuery "+t),void 0):f.init.apply(this,arguments)},e.fn[t].defaults={continuous:!0,offset:0,triggerOnce:!1,context:n},e[i]=function(e){return d[e]?d[e].apply(this):d.aggregate()},e[i].settings={resizeThrottle:200,scrollThrottle:100},r.load(function(){e[i]("refresh")})})(jQuery,"waypoint","waypoints",window);